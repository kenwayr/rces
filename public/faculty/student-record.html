<style type="text/css">
.badge-active
{
    color: #fff;
    background-color: #28a745;
}
</style>
<div class="col-md-12">
    <div class="x_panel">
        <div class="x_content">
            <div class="clearfix"></div>
            <div id="studentProfileContainer" class="row"></div>
        </div>
    </div>
</div>

<div id="profileTemplate" class="hidden">
    <div class="col-md-4 col-sm-4 col-xs-12 animated fadeInDown">
        <div class="well profile_view">
            <div class="col-sm-12">
                <h4 class="brief">
                    <i>{{identifier}}</i>
                    <span class="badge badge-active">{{active}}</span>
                </h4>
                <div class="left col-xs-7">
                    <h2>{{name}}</h2>
                    <p><strong>Device ID: </strong> {{deviceID}} </p>
                    <ul class="list-unstyled">
                        <li><i class="fa fa-phone"></i> {{number}} </li>
                        <li><i class="fa fa-envelope"></i> {{email}}</li>
                        <li><i class="fa fa-user"></i> {{gender}}</li>
                    </ul>
                </div>
                <div class="right col-xs-5 text-center">
                    <img src="../commons/images/user.png" alt="" class="img-circle img-responsive">
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function (){
    if(app !== null)
    {
        UpdateView();
        app.addCallback('students', function(d) {
            UpdateView();
        });
    }
});

function UpdateView() {
    app.send(
        {
            tag: "request.get",
            type: "profiles",
            data: {
                type: { $ne: "faculty" }
            }
        },
        function (message) {
            console.log(message);
            if(message.data.hasOwnProperty('profiles'))
                UpdateProfilesView(message.data.profiles);
        }
    );
}

function UpdateProfilesView(profiles) {
    var template = $("#profileTemplate").html(), profileView;
    $("#studentProfileContainer").html('');
    for(var i=0; i < profiles.length; i++)
    {
        profileView = template.replace("{{identifier}}", profiles[i].identifier || "N/A");
        profileView = profileView.replace("{{name}}", profiles[i].name || "N/A");
        profileView = profileView.replace("{{email}}", profiles[i].email || "N/A");
        profileView = profileView.replace("{{number}}", profiles[i].number || "N/A");
        profileView = profileView.replace("{{deviceID}}", profiles[i].device_id || "N/A");
        profileView = profileView.replace("{{gender}}", profiles[i].gender || "N/A");
        if(app.students.filter((v) => { return v.number == profiles[i].number; }).length > 0)
            profileView = profileView.replace("{{active}}", "active");
        else
            profileView = profileView.replace("{{active}}", "");
        $("#studentProfileContainer").append(profileView);
    }
}
</script>